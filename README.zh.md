# Modu-Arena - Claude Code ä»£ç†æ’è¡Œæ¦œ

![Next.js](https://img.shields.io/badge/Next.js-16.1-black?style=flat-square&logo=next.js)
![TypeScript](https://img.shields.io/badge/TypeScript-5.x-blue?style=flat-square&logo=typescript)
![PostgreSQL](https://img.shields.io/badge/PostgreSQL-Docker-336791?style=flat-square&logo=postgresql)
![Auth](https://img.shields.io/badge/Auth-Custom_JWT-orange?style=flat-square)
![License](https://img.shields.io/badge/License-Copyleft-green?style=flat-square)

è¿½è¸ª Claude Code ä»¤ç‰Œä½¿ç”¨é‡çš„ç«äº‰å‹æ’è¡Œæ¦œå¹³å°ã€‚è¿½è¸ªæ‚¨çš„ AI ç¼–ç ä¼šè¯ï¼Œä¸ç¤¾åŒºç«äº‰ï¼Œé€šè¿‡ä»£ç†ç¼–ç åˆ†æå‘ç°æ‚¨ç‹¬ç‰¹çš„ç¼–ç é£æ ¼ã€‚

[English](README.md) | [í•œêµ­ì–´](README.ko.md) | [æ—¥æœ¬èª](README.ja.md) | [ä¸­æ–‡](README.zh.md)

> **âš ï¸ é‡è¦å…¬å‘Š (2025-01-25)**
>
> ç”±äºç”Ÿäº§ç¯å¢ƒè¿ç§»ï¼Œ**æ‰€æœ‰ç°æœ‰è´¦æˆ·å·²è¢«é‡ç½®**ã€‚å¦‚æœæ‚¨ä¹‹å‰å·²æ³¨å†Œï¼Œè¯·åœ¨ [arena.modu.ai](https://arena.modu.ai) **é‡æ–°æ³¨å†Œ**ã€‚ç»™æ‚¨å¸¦æ¥ä¸ä¾¿ï¼Œæ·±è¡¨æ­‰æ„ã€‚

---

## ğŸ“š å¤§å®¶ AI ä»£ç†ç¼–ç è®²åº§

æœ¬é¡¹ç›®ä½œä¸º **å±•ç¤º Modu-Arena å®é™…åº”ç”¨çš„è®²åº§ç¤ºä¾‹**è€Œåˆ›å»ºã€‚

### ğŸ¯ é¡¹ç›®ç›®çš„

**ä½“éªŒä»£ç†ç¼–ç çš„æ–°ç»´åº¦ï¼**

Modu-Arena çš„åˆ›å»ºç›®çš„å¦‚ä¸‹ï¼š

- **å®æˆ˜ AI ä»£ç†ç¼–æ’**: é€šè¿‡ 20 ä¸ªä¸“ä¸šä»£ç†åä½œæ„å»ºçš„å®Œæ•´ç³»ç»Ÿ
- **SPEC-First TDD å®ç°**: ä»è§„æ ¼è¯´æ˜åˆ°æµ‹è¯•çš„å®Œç¾è´¨é‡æµç¨‹
- **å¯æ‰©å±•æ¶æ„**: åº”ç”¨ç¼“å­˜ã€æ•°æ®ä¿ç•™ç­–ç•¥ã€æ€§èƒ½ä¼˜åŒ–çš„å®æˆ˜ä»£ç 
- **å¼€æºè´¡çŒ®**: å…¬å¼€æ‰€æœ‰ä»£ç ä¸ºç¤¾åŒºå­¦ä¹ åšè´¡çŒ®

### âš ï¸ å¼€å‘ç¯å¢ƒ

**48 å°æ—¶é»‘å®¢é©¬æ‹‰æ¾é¡¹ç›®**

æœ¬é¡¹ç›®åœ¨ 48 å°æ—¶å†…ä½¿ç”¨ Modu-Arena é›†ä¸­å¼€å‘å®Œæˆã€‚å±•ç¤ºå®æˆ˜ç¯å¢ƒä¸­å¿«é€Ÿå¼€å‘çš„å®è¯ç¤ºä¾‹ã€‚

**å¼€å‘ç‰¹å¾**ï¼š

- ä½¿ç”¨ Modu-Arena çš„ `/modu` ç»Ÿä¸€è‡ªä¸»è‡ªåŠ¨åŒ–å‘½ä»¤å®ç°æ ¸å¿ƒåŠŸèƒ½
- æ··åˆä½¿ç”¨ GLM 4.7 å’Œ Claude Opus è¿›è¡Œæˆæœ¬æ•ˆç›Šå¼€å‘
- Worktree å¹¶è¡Œå¼€å‘åŒæ—¶å¼€å‘ç‹¬ç«‹åŠŸèƒ½æ¨¡å—

**æµ‹è¯•ä¸è¶³è¯´æ˜**ï¼š

- ç”±äº 48 å°æ—¶å¼€å‘ï¼Œå¯èƒ½æœªè¿›è¡Œå……åˆ†æµ‹è¯•
- å¦‚æœå‘ç°ä»»ä½•é”™è¯¯æˆ–æ”¹è¿›å»ºè®®ï¼Œè¯·åœ¨ [GitHub Issues](https://github.com/modu-ai/modu-arena/issues) ç•™è¨€
- ç¤¾åŒºè´¡çŒ®ä½¿é¡¹ç›®æ›´åŠ ç¨³å¥

### ğŸ”— ç›¸å…³é¡¹ç›®

- **[Modu-Arena](https://github.com/modulabs/modu-arena)**: AI å¼€å‘æ¡†æ¶

---

## ğŸš€ å¼€å§‹ä¹‹å‰ï¼šå®‰è£… Modu-Arena

ä½¿ç”¨ Modu-Arena ä¹‹å‰ï¼Œå¿…é¡»å…ˆå®‰è£… **Modu-Arena**ã€‚

### ä»€ä¹ˆæ˜¯ Modu-Arenaï¼Ÿ

Modu-Arena æ˜¯ä¸€ä¸ª **åˆ›å»ºé«˜è´¨é‡ä»£ç çš„ AI å¼€å‘æ¡†æ¶**ã€‚

- **SPEC-First TDD**: é€šè¿‡æ˜ç¡®çš„è§„æ ¼è¯´æ˜å‡å°‘ 90% çš„è¿”å·¥
- **AI ç¼–æ’**: 20 ä¸ªä¸“ä¸šä»£ç† + 48 ä¸ªæŠ€èƒ½
- **å¤šè¯­è¨€æ”¯æŒ**: è‡ªåŠ¨æ”¯æŒéŸ©è¯­/è‹±è¯­/æ—¥è¯­/ä¸­æ–‡
- **Worktree å¹¶è¡Œå¼€å‘**: åœ¨å®Œå…¨éš”ç¦»çš„ç¯å¢ƒä¸­è¿›è¡Œæ— é™åˆ¶çš„å¹¶è¡Œå·¥ä½œ
- **Modu-Arena**: é€šè¿‡ vibe coding æ’è¡Œæ¦œæä¾›åŠ¨åŠ›

### å¿«é€Ÿå®‰è£…

```bash
# æ–¹æ³• 1: å¿«é€Ÿå®‰è£…ï¼ˆæ¨èï¼‰
curl -LsSf https://modu-ai.github.io/modu-arena/install.sh | sh

# æ–¹æ³• 2: æ‰‹åŠ¨å®‰è£…
# æ­¥éª¤ 1: å®‰è£… uvï¼ˆmacOS/Linuxï¼‰
curl -LsSf https://astral.sh/uv/install.sh | sh

# æ­¥éª¤ 2: å®‰è£… Modu-Arena
uv tool install modu-arena
```

---

## ğŸ® Modu-Arena CLI å‘½ä»¤

å®‰è£… Modu-Arena åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Modu-Arena CLIã€‚

### å‘½ä»¤æ¦‚è¿°

```bash
modu arena [OPTIONS] COMMAND [ARGS]...

Modu-Arena - Claude Code ä»¤ç‰Œä½¿ç”¨é‡æ’è¡Œæ¦œ

è¿½è¸ªæ‚¨çš„ Claude Code ä¼šè¯å¹¶åœ¨æ’è¡Œæ¦œä¸Šç«äº‰ã€‚
ç½‘é¡µä»ªè¡¨æ¿: https://arena.modu.ai

é€‰é¡¹:
  --help    æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯

å‘½ä»¤:
  login      é€šè¿‡ GitHub OAuth ç™»å½• Modu-Arena (åˆ«å: register)
  status     æ˜¾ç¤ºå½“å‰æ’åå’Œç»Ÿè®¡ä¿¡æ¯
  exclude    å°†é¡¹ç›®ä»ä¼šè¯è¿½è¸ªä¸­æ’é™¤
  include    é‡æ–°åŒ…å«ä¹‹å‰æ’é™¤çš„é¡¹ç›®
  logout     åˆ é™¤å­˜å‚¨çš„ Modu-Arena å‡­è¯ä¿¡æ¯
```

### å‘½ä»¤è¯¦ç»†è¯´æ˜

#### 1. login - GitHub OAuth ç™»å½•

```bash
modu arena login
```

> **æ³¨æ„**: `modu arena register` ä½œä¸ºåˆ«åç»§ç»­æ”¯æŒ,ä»¥ä¿æŒå‘åå…¼å®¹æ€§ã€‚

**å·¥ä½œåŸç†**:

1. æ‰“å¼€æµè§ˆå™¨è¿›è¡Œ GitHub OAuth è®¤è¯
2. è®¤è¯æˆåŠŸåè‡ªåŠ¨ç”Ÿæˆå¹¶å­˜å‚¨ API å¯†é’¥
3. å®‰è£…å…¨å±€æŒ‚é’©å¼€å§‹è‡ªåŠ¨ä¼šè¯è¿½è¸ª
4. å°† API å¯†é’¥å®‰å…¨å­˜å‚¨åœ¨ `~/.modu/rank/credentials.json`

**æ‰§è¡Œç¤ºä¾‹**:

```bash
â¯ modu arena login

â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Login â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ Modu-Arena Login                                                      â”‚
â”‚                                                                      â”‚
â”‚ This will open your browser to authorize with GitHub.                â”‚
â”‚ After authorization, your API key will be stored securely.           â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

Opening browser for GitHub authorization...
Waiting for authorization (timeout: 5 minutes)...

â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Login Complete â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ Successfully logged in as your-github-id                             â”‚
â”‚                                                                      â”‚
â”‚ API Key: modu_arena_a9011fac_c...                                     â”‚
â”‚ Stored in: ~/.modu/rank/credentials.json                             â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Global Hook Installed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ Session tracking hook installed globally.                            â”‚
â”‚                                                                      â”‚
â”‚ Your Claude Code sessions will be automatically tracked.             â”‚
â”‚ Hook location: ~/.claude/hooks/modu/session_end__rank_submit.py      â”‚
â”‚                                                                      â”‚
â”‚ To exclude specific projects:                                        â”‚
â”‚   modu arena exclude /path/to/project                                 â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
```

#### 2. sync - åŒæ­¥ä¼šè¯æ•°æ®

```bash
modu arena sync
```

å°†æœ¬åœ° Claude Code ä¼šè¯æ•°æ®åŒæ­¥åˆ° Modu-Arena æœåŠ¡å™¨ã€‚

**è¾“å‡ºç¤ºä¾‹:**

```bash
â¯ modu arena sync

Syncing 2577 session(s) to Modu-Arena
Phase 1: Parsing transcripts (parallel: 20 workers)

Parsing transcripts â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 100% (2577/2577)

Phase 2: Submitting 1873 session(s) (batch mode)
Batch size: 100 | Batches: 19

Submitting batches â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 100% (19/19)

Sync Complete
âœ“ Submitted: 0
â—‹ Skipped:   704 (no usage or duplicate)
âœ— Failed:    500
```

#### 3. status - æŸ¥çœ‹æˆ‘çš„æ’å

```bash
modu arena status
```

**å·¥ä½œåŸç†**:

- ä½¿ç”¨å­˜å‚¨çš„ API å¯†é’¥è°ƒç”¨ `/api/v1/rank` ç«¯ç‚¹
- ä»æœåŠ¡å™¨æ£€ç´¢ç”¨æˆ·ç‰¹å®šçš„æ’åæ•°æ®
- æ˜¾ç¤ºæ—¥æ¬¡/å‘¨æ¬¡/æœˆæ¬¡/å…¨æœŸé—´æ’åå’Œç»Ÿè®¡ä¿¡æ¯

**æ‰§è¡Œç¤ºä¾‹**:

```bash
â¯ modu arena status

â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Modu-Arena â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ your-github-id                                                       â”‚
â”‚                                                                      â”‚
â”‚ ğŸ† Global Rank: #42                                                  â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
â•­â”€â”€â”€â”€â”€ Daily â”€â”€â”€â”€â”€â”€â•®  â•­â”€â”€â”€â”€â”€ Weekly â”€â”€â”€â”€â”€â•®  â•­â”€â”€â”€â”€ Monthly â”€â”€â”€â”€â”€â•®  â•­â”€â”€â”€â”€ All Time â”€â”€â”€â”€â•®
â”‚ #12              â”‚  â”‚ #28              â”‚  â”‚ #42              â”‚  â”‚ #156             â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯  â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯  â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯  â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Token Usage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ 1,247,832 total tokens                                               â”‚
â”‚                                                                      â”‚
â”‚ Input  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘ 847,291 (68%)                            â”‚
â”‚ Output â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 400,541 (32%)                            â”‚
â”‚                                                                      â”‚
â”‚ Sessions: 47                                                         â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

â— Hook: Installed  |  https://arena.modu.ai
```

#### 4. exclude/include - é¡¹ç›®ç®¡ç†

```bash
# æ’é™¤å½“å‰é¡¹ç›®
modu arena exclude

# æ’é™¤ç‰¹å®šè·¯å¾„
modu arena exclude /path/to/private

# é€šé…ç¬¦æ¨¡å¼
modu arena exclude "*/confidential/*"

# åˆ—å‡ºæ’é™¤çš„é¡¹ç›®
modu arena list-excluded

# é‡æ–°åŒ…å«
modu arena include /path/to/project
```

**éšç§ä¿æŠ¤**:

- å¯ä»¥ä»è¿½è¸ªä¸­æ’é™¤æ•æ„Ÿé¡¹ç›®
- æ’é™¤çš„é¡¹ç›®æ•°æ®ä¸ä¼šå‘é€åˆ°æœåŠ¡å™¨

#### 5. logout - ç™»å‡º

```bash
modu arena logout
```

- åˆ é™¤å­˜å‚¨çš„ API å¯†é’¥
- åˆ é™¤å…¨å±€æŒ‚é’©
- åœæ­¢æ‰€æœ‰è¿½è¸ª

---

## ğŸ“Š æ”¶é›†çš„æŒ‡æ ‡

| æŒ‡æ ‡           | è¯´æ˜                      | æ˜¯å¦æ”¶é›† |
| -------------- | ------------------------- | -------- |
| **ä»¤ç‰Œä½¿ç”¨é‡** | è¾“å…¥/è¾“å‡ºä»¤ç‰Œã€ç¼“å­˜ä»¤ç‰Œ   | O        |
| **å·¥å…·ä½¿ç”¨**   | Readã€Editã€Bash ä½¿ç”¨æ¬¡æ•° | O        |
| **æ¨¡å‹ä½¿ç”¨**   | Opusã€Sonnetã€Haiku è¯¦ç»†  | O        |
| **ä»£ç æŒ‡æ ‡**   | æ·»åŠ /åˆ é™¤è¡Œã€ä¿®æ”¹æ–‡ä»¶     | O        |
| **ä¼šè¯ä¿¡æ¯**   | æŒç»­æ—¶é—´ã€å›åˆæ•°ã€æ—¶é—´æˆ³  | O        |
| **ä»£ç å†…å®¹**   | å®é™…ä»£ç å†…å®¹              | X        |
| **æ–‡ä»¶è·¯å¾„**   | é¡¹ç›®å†…çš„æ–‡ä»¶è·¯å¾„          | X        |
| **æç¤º**       | ä¸ Claude çš„å¯¹è¯å†…å®¹      | X        |

**ä¿è¯**: æ”¶é›†çš„æ•°æ®**ä»…åŒ…å«æ•°å€¼æŒ‡æ ‡**ï¼Œä»ä¸ä¼ è¾“ä»£ç å†…å®¹æˆ–å¯¹è¯è¯¦ç»†ä¿¡æ¯ã€‚

---

## ç›®å½•

- [åŠŸèƒ½](#åŠŸèƒ½)
- [æ¶æ„](#æ¶æ„)
- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
- [å¼€å§‹ä½¿ç”¨](#å¼€å§‹ä½¿ç”¨)
- [ç¯å¢ƒå˜é‡](#ç¯å¢ƒå˜é‡)
- [æ•°æ®åº“æ¶æ„](#æ•°æ®åº“æ¶æ„)
- [API å‚è€ƒ](#api-å‚è€ƒ)
- [å¼€å‘](#å¼€å‘)
- [éƒ¨ç½²](#éƒ¨ç½²)
- [å®‰å…¨](#å®‰å…¨)
- [æ€§èƒ½å’Œå¯æ‰©å±•æ€§](#æ€§èƒ½å’Œå¯æ‰©å±•æ€§)

## åŠŸèƒ½

### æ’åç³»ç»Ÿ

- **å¤šæœŸé—´æ’å**: æ—¥æ¬¡ã€å‘¨æ¬¡ã€æœˆæ¬¡å’Œå…¨æœŸé—´æ’è¡Œæ¦œ
- **ç»¼åˆè¯„åˆ†è®¡ç®—**: è€ƒè™‘å¤šä¸ªå› ç´ çš„åŠ æƒç®—æ³•
  - ä»¤ç‰Œä½¿ç”¨é‡ (40%): æ€»è¾“å…¥ + è¾“å‡ºä»¤ç‰Œ
  - æ•ˆç‡ (25%): è¾“å‡º/è¾“å…¥æ¯”ä¼˜åŒ–
  - ä¼šè¯æ•° (20%): ç¼–ç ä¼šè¯æ•°
  - è¿ç»­è®°å½• (15%): è¿ç»­æ´»è·ƒå¤©æ•°

### Vibe ç¼–ç åˆ†æ

é€šè¿‡ AI åˆ†æå‘ç°æ‚¨ç‹¬ç‰¹çš„ç¼–ç é£æ ¼ï¼š

- **æ¢ç´¢è€…**: ä¸“æ³¨äºä»£ç æ¢ç´¢å’Œç³»ç»Ÿç†è§£
- **åˆ›é€ è€…**: ä¸“æ³¨äºåˆ›å»ºæ–°åŠŸèƒ½å’Œä»£ç 
- **é‡æ„è€…**: æ“…é•¿æ”¹è¿›ç°æœ‰ä»£ç 
- **è‡ªåŠ¨åŒ–è€…**: ä»»åŠ¡è‡ªåŠ¨åŒ–å’Œå·¥ä½œæµç¨‹åè°ƒ

### ä»ªè¡¨æ¿åŠŸèƒ½

- å®æ—¶ä»¤ç‰Œä½¿ç”¨é‡è¿½è¸ª
- æ´»åŠ¨çƒ­åŠ›å›¾ï¼ˆGitHub é£æ ¼ï¼‰
- æ¨¡å‹ä½¿ç”¨é‡åˆ†æ
- æ¯å°æ—¶æ´»åŠ¨æ¨¡å¼
- æ¯å‘¨ç¼–ç æ¨¡å¼
- å·¥å…·ä½¿ç”¨ç»Ÿè®¡
- åŒ¿åå‚ä¸çš„éšç§æ¨¡å¼

### å¤šè¯­è¨€æ”¯æŒ

å®Œå…¨æ”¯æŒ 4 ç§è¯­è¨€ï¼š

- è‹±è¯­ (en)
- éŸ©è¯­ (ko)
- æ—¥è¯­ (ja)
- ä¸­æ–‡ (zh)

## æ¶æ„

```
apps/web/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ [locale]/         # å¤šè¯­è¨€è·¯ç”± (next-intl)
â”‚   â”‚   â”‚   â”œâ”€â”€ api/          # API è·¯ç”±
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ v1/       # å…¬å¼€ CLI API (v1)
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ sessions/ # ä¼šè¯è®°å½•
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ rank/     # ç”¨æˆ·æ’å
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ status/   # API çŠ¶æ€æ£€æŸ¥
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ verify/   # API å¯†é’¥éªŒè¯
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ me/       # ç”¨æˆ·ä»ªè¡¨æ¿ API
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ leaderboard/ # å…¬å¼€æ’è¡Œæ¦œ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ cron/     # å®šæ—¶ä»»åŠ¡
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ calculate-rankings/ # æ’åè®¡ç®—
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ cleanup-data/       # æ•°æ®æ¸…ç†
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ auth/     # CLI è®¤è¯
â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/    # ç”¨æˆ·ä»ªè¡¨æ¿é¡µé¢
â”‚   â”‚   â”‚   â””â”€â”€ users/        # å…¬å¼€ç”¨æˆ·èµ„æ–™
â”‚   â”‚   â”œâ”€â”€ layout.tsx        # æ ¹å¸ƒå±€
â”‚   â”‚   â””â”€â”€ globals.css       # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ cache/                 # ç¼“å­˜å±‚
â”‚   â”‚   â”œâ”€â”€ config.ts         # ç¼“å­˜ TTL è®¾ç½®
â”‚   â”‚   â””â”€â”€ keys.ts           # ç¼“å­˜å¯†é’¥ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ components/            # React ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ui/               # åŸºç¡€ UI ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ layout/           # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ leaderboard/      # æ’è¡Œæ¦œç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ dashboard/        # ä»ªè¡¨æ¿ç»„ä»¶
â”‚   â”‚   â””â”€â”€ profile/          # èµ„æ–™ç»„ä»¶
â”‚   â”œâ”€â”€ db/                    # æ•°æ®åº“å±‚
â”‚   â”‚   â”œâ”€â”€ schema.ts         # Drizzle ORM æ¶æ„
â”‚   â”‚   â”œâ”€â”€ index.ts          # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”œâ”€â”€ rls.ts            # è¡Œçº§å®‰å…¨
â”‚   â”‚   â””â”€â”€ seed.ts           # ç§å­æ•°æ®è„šæœ¬
â”‚   â”œâ”€â”€ lib/                   # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ auth.ts           # API å¯†é’¥å’Œ HMAC è®¤è¯
â”‚   â”‚   â”œâ”€â”€ audit.ts          # å®‰å…¨å®¡è®¡æ—¥å¿—
â”‚   â”‚   â”œâ”€â”€ cache.ts          # Redis ç¼“å­˜å·¥å…·
â”‚   â”‚   â”œâ”€â”€ rate-limiter.ts   # é€Ÿç‡é™åˆ¶
â”‚   â”‚   â”œâ”€â”€ score.ts          # è¯„åˆ†è®¡ç®—
â”‚   â”‚   â””â”€â”€ api-response.ts   # å“åº”åŠ©æ‰‹
â”‚   â””â”€â”€ i18n/                  # å›½é™…åŒ–
â”œâ”€â”€ messages/                   # ç¿»è¯‘æ–‡ä»¶
â””â”€â”€ drizzle/                   # æ•°æ®åº“è¿ç§»
```

### ç³»ç»Ÿæ¶æ„

![ç³»ç»Ÿæ¶æ„](docs/system-architecture.png)

## æŠ€æœ¯æ ˆ

| ç±»åˆ«   | æŠ€æœ¯              | ç›®çš„                       |
| ------ | ----------------- | -------------------------- |
| æ¡†æ¶   | Next.js 16        | å…¨æ ˆ React æ¡†æ¶            |
| è¯­è¨€   | TypeScript 5      | ç±»å‹å®‰å…¨å¼€å‘               |
| æ•°æ®åº“ | PostgreSQL        | Docker å®¹å™¨æ•°æ®åº“          |
| ORM    | Drizzle ORM       | ç±»å‹å®‰å…¨æ•°æ®åº“æŸ¥è¯¢         |
| è®¤è¯   | Custom JWT        | é‚®ç®± OTP æ³¨å†Œ + å¯†ç ç™»å½•   |
| ä»£ç†   | Caddy             | HTTPS åå‘ä»£ç†             |
| è¿›ç¨‹   | PM2               | Node.js è¿›ç¨‹ç®¡ç†å™¨         |
| é‚®ä»¶   | Gmail REST API    | OTP éªŒè¯é‚®ä»¶               |
| UI     | Tailwind CSS 4    | æ ·å¼                       |
| ç»„ä»¶   | Radix UI          | æ— éšœç¢ UI åŸè¯­             |
| å›¾è¡¨   | Recharts          | æ•°æ®å¯è§†åŒ–                 |
| i18n   | next-intl         | å›½é™…åŒ–               |
| éªŒè¯   | Zod               | è¿è¡Œæ—¶ç±»å‹éªŒè¯       |

## å¼€å§‹ä½¿ç”¨

### å‰ææ¡ä»¶

- **Node.js** 20.x æˆ–æ›´é«˜ç‰ˆæœ¬
- **Bun** 1.xï¼ˆæ¨èï¼‰æˆ– npm/yarn
- **PostgreSQL**ï¼ˆDocker å®¹å™¨æˆ–ç‹¬ç«‹å®‰è£…ï¼‰
- ç”Ÿäº§ç¯å¢ƒç”¨ **Caddy** HTTPS åå‘ä»£ç†
- ç”Ÿäº§ç¯å¢ƒç”¨ **PM2** Node.js è¿›ç¨‹ç®¡ç†å™¨

### å®‰è£…

1. **å…‹éš†ä»“åº“**

```bash
git clone https://github.com/your-org/modu-arena.git
cd modu-arena/apps/web
```

2. **å®‰è£…ä¾èµ–**

```bash
bun install
```

3. **è®¾ç½®ç¯å¢ƒå˜é‡**

```bash
cp .env.example .env.local
# æ‰“å¼€ .env.local å¹¶è¾“å…¥æ‚¨çš„å‡­è¯
```

4. **è®¾ç½®æ•°æ®åº“**

```bash
# ç”Ÿæˆè¿ç§»
bun run db:generate

# å°†æ¶æ„æ¨é€åˆ°æ•°æ®åº“
bun run db:push

# ï¼ˆå¯é€‰ï¼‰ç§å­ç¤ºä¾‹æ•°æ®
bun run db:seed
```

5. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**

```bash
bun run dev
```

æ‰“å¼€ [http://localhost:3000](http://localhost:3000) æŸ¥çœ‹åº”ç”¨ç¨‹åºã€‚

## ç¯å¢ƒå˜é‡

### å¿…éœ€å˜é‡

| å˜é‡                                | è¯´æ˜                 | ç¤ºä¾‹                                             |
| ----------------------------------- | -------------------- | ------------------------------------------------ |
| `DATABASE_URL`                      | PostgreSQL è¿æ¥å­—ç¬¦ä¸² | `postgresql://user:pass@localhost:5432/dbname`    |
| `JWT_SECRET`                        | JWT ç­¾åå¯†é’¥          | `your-secure-random-string`                       |

### å¯é€‰å˜é‡

| å˜é‡                | è¯´æ˜                               | é»˜è®¤å€¼       |
| ------------------- | ---------------------------------- | ------------ |
| `GMAIL_CLIENT_ID`      | Gmail OAuth2 å®¢æˆ·ç«¯ ID     | OTP é‚®ä»¶å‘é€å¿…éœ€ |
| `GMAIL_CLIENT_SECRET`  | Gmail OAuth2 å®¢æˆ·ç«¯å¯†é’¥    | OTP é‚®ä»¶å‘é€å¿…éœ€ |
| `GMAIL_REFRESH_TOKEN`  | Gmail OAuth2 åˆ·æ–°ä»¤ç‰Œ      | OTP é‚®ä»¶å‘é€å¿…éœ€ |
| `GMAIL_USER`           | Gmail å‘ä»¶äººé‚®ç®±åœ°å€       | OTP é‚®ä»¶å‘é€å¿…éœ€ |
| `CRON_SECRET`          | Cron ä½œä¸šè®¤è¯å¯†é’¥          | ç”Ÿäº§ç¯å¢ƒå¿…éœ€     |

### .env.local ç¤ºä¾‹

```env
# æ•°æ®åº“ï¼ˆå¿…éœ€ï¼‰
DATABASE_URL="postgresql://modu:password@localhost:5432/modu_rank"

# JWT è®¤è¯ï¼ˆå¿…éœ€ï¼‰
JWT_SECRET="your-secure-random-string"

# Gmail OAuth2ï¼ˆé‚®ç®± OTP å¿…éœ€ï¼‰
GMAIL_CLIENT_ID="your-client-id"
GMAIL_CLIENT_SECRET="your-client-secret"
GMAIL_REFRESH_TOKEN="your-refresh-token"
GMAIL_USER="your-email@gmail.com"

# Cron è®¤è¯ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…éœ€ï¼‰
CRON_SECRET="your-secure-random-string"
```

## æ•°æ®åº“æ¶æ„

### å®ä½“å…³ç³»å›¾

```mermaid
erDiagram
    users ||--o{ sessions : has
    users ||--o{ token_usage : has
    users ||--o{ daily_user_stats : has
    users ||--o{ rankings : has
    users ||--o{ project_evaluations : has
    users ||--o| user_stats : has
    users ||--o{ security_audit_log : logs
    users ||--o{ email_verifications : verifies
    tool_types ||--o{ sessions : identifies
    tool_types ||--o{ token_usage : identifies
    sessions ||--o{ token_usage : has

    users {
        uuid id PK
        varchar username UK
        varchar password_hash
        varchar github_id UK
        varchar github_username
        text github_avatar_url
        varchar display_name
        varchar email
        varchar api_key_hash
        varchar api_key_prefix
        varchar user_salt
        boolean privacy_mode
        integer successful_projects_count
        timestamp created_at
        timestamp updated_at
    }

    email_verifications {
        uuid id PK
        varchar email
        varchar code
        timestamp expires_at
        boolean used
        timestamp created_at
    }

    tool_types {
        varchar id PK
        varchar name
        varchar display_name
        text icon_url
        varchar color
        boolean is_active
        integer sort_order
        timestamp created_at
    }

    sessions {
        uuid id PK
        uuid user_id FK
        varchar tool_type_id FK
        varchar session_hash UK
        varchar anonymous_project_id
        timestamp started_at
        timestamp ended_at
        integer duration_seconds
        varchar model_name
        integer turn_count
        jsonb tool_usage
        jsonb code_metrics
        timestamp created_at
    }

    token_usage {
        uuid id PK
        uuid session_id FK
        uuid user_id FK
        varchar tool_type_id FK
        bigint input_tokens
        bigint output_tokens
        bigint cache_creation_tokens
        bigint cache_read_tokens
        timestamp recorded_at
    }

    project_evaluations {
        uuid id PK
        uuid user_id FK
        varchar project_path_hash
        varchar project_name
        integer local_score
        integer backend_score
        integer penalty_score
        integer final_score
        integer cumulative_score_after
        varchar llm_model
        varchar llm_provider
        boolean passed
        text feedback
        timestamp evaluated_at
    }

    user_stats {
        uuid user_id PK_FK
        bigint total_input_tokens
        bigint total_output_tokens
        bigint total_cache_tokens
        bigint total_all_tokens
        jsonb tokens_by_tool
        integer total_sessions
        jsonb sessions_by_tool
        integer successful_projects_count
        integer total_evaluations
        timestamp last_activity_at
        timestamp updated_at
    }

    daily_user_stats {
        uuid id PK
        uuid user_id FK
        date stat_date
        bigint input_tokens
        bigint output_tokens
        bigint cache_tokens
        bigint total_tokens
        integer session_count
        jsonb by_tool
        timestamp created_at
    }

    rankings {
        uuid id PK
        uuid user_id FK
        varchar period_type
        date period_start
        integer rank_position
        bigint total_tokens
        decimal composite_score
        integer session_count
        decimal efficiency_score
        timestamp updated_at
    }

    security_audit_log {
        uuid id PK
        uuid user_id FK
        varchar event_type
        varchar ip_address
        text user_agent
        jsonb details
        timestamp created_at
    }
```

### è¡¨æ¦‚è¿°

| è¡¨                    | è¯´æ˜                           |
| --------------------- | ------------------------------ |
| `users`               | åŸºäºé‚®ç®±/å¯†ç è®¤è¯çš„ç”¨æˆ·è´¦æˆ·   |
| `email_verifications` | æ³¨å†Œæ—¶é‚®ç®±éªŒè¯ç”¨OTPéªŒè¯ç      |
| `tool_types`          | æ”¯æŒçš„AIç¼–ç¨‹å·¥å…·æ³¨å†Œè¡¨        |
| `sessions`            | åŒ…å«å…ƒæ•°æ®çš„AIç¼–ç¨‹å·¥å…·ä¼šè¯è®°å½• |
| `token_usage`         | æ¯ä¸ªä¼šè¯çš„è¯¦ç»†ä»¤ç‰Œæ¶ˆè€—é‡      |
| `project_evaluations` | åŸºäºLLMçš„é¡¹ç›®è¯„ä¼°ç»“æœ         |
| `user_stats`          | ä»ªè¡¨æ¿ç”¨æ±‡æ€»ç”¨æˆ·ç»Ÿè®¡          |
| `daily_user_stats`    | å†å²å›¾è¡¨ç”¨æ¯æ—¥æ±‡æ€»            |
| `rankings`            | æ¯ä¸ªæœŸé—´çš„è®¡ç®—æ’å            |
| `security_audit_log`  | å®‰å…¨äº‹ä»¶å®¡è®¡è·Ÿè¸ª              |

## API å‚è€ƒ

### API v1 (CLI é›†æˆ)

åŸºç¡€ URL: `/api/v1`

#### API çŠ¶æ€æ£€æŸ¥

```http
GET /api/v1/status
```

å“åº”:

```json
{
  "status": "operational",
  "version": "1.0.0",
  "timestamp": "2025-01-11T00:00:00.000Z",
  "endpoints": {
    "sessions": "/api/v1/sessions",
    "rank": "/api/v1/rank",
    "status": "/api/v1/status"
  }
}
```

#### API å¯†é’¥éªŒè¯

```http
GET /api/v1/verify
X-API-Key: modu_arena_xxxxxxxx_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

å“åº”:

```json
{
  "valid": true,
  "username": "developer",
  "apiKeyPrefix": "modu_arena_xxxxxxxx",
  "privacyMode": false,
  "createdAt": "2025-01-01T00:00:00.000Z"
}
```

#### ä¼šè¯è®°å½•

```http
POST /api/v1/sessions
Content-Type: application/json
X-API-Key: modu_arena_xxxxxxxx_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
X-Timestamp: 1704067200
X-Signature: <HMAC-SHA256 ç­¾å>
```

è¯·æ±‚ä½“:

```json
{
  "sessionHash": "<64ä½å“ˆå¸Œ>",
  "endedAt": "2025-01-11T12:00:00.000Z",
  "inputTokens": 50000,
  "outputTokens": 10000,
  "cacheCreationTokens": 5000,
  "cacheReadTokens": 20000,
  "modelName": "claude-sonnet-4-20250514",
  "anonymousProjectId": "proj_abc123"
}
```

å“åº”:

```json
{
  "success": true,
  "sessionId": "uuid",
  "message": "Session recorded successfully"
}
```

#### ç”¨æˆ·æ’åæŸ¥è¯¢

```http
GET /api/v1/rank
X-API-Key: modu_arena_xxxxxxxx_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

å“åº”:

```json
{
  "username": "developer",
  "rankings": {
    "daily": {
      "position": 5,
      "compositeScore": 450.25,
      "totalParticipants": 100
    },
    "weekly": {
      "position": 12,
      "compositeScore": 380.5,
      "totalParticipants": 250
    },
    "monthly": null,
    "allTime": {
      "position": 8,
      "compositeScore": 520.75,
      "totalParticipants": 500
    }
  },
  "stats": {
    "totalTokens": 1500000,
    "totalSessions": 45,
    "inputTokens": 1200000,
    "outputTokens": 300000
  },
  "lastUpdated": "2025-01-11T00:00:00.000Z"
}
```

### å…¬å¼€ API

#### æ’è¡Œæ¦œæŸ¥è¯¢

```http
GET /api/leaderboard?period=weekly&limit=50&offset=0
```

æŸ¥è¯¢å‚æ•°:
| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| -------- | ------- | -------- | ----------------------------------------- |
| `period` | string | `weekly` | `daily`, `weekly`, `monthly`, `all_time` |
| `limit` | number | `50` | æ¯é¡µç»“æœæ•° (1-100) |
| `offset` | number | `0` | åˆ†é¡µåç§» |

å“åº”:

```json
{
  "data": [
    {
      "rank": 1,
      "userId": "uuid",
      "username": "top_coder",
      "avatarUrl": "https://...",
      "totalTokens": 5000000,
      "compositeScore": 850.5,
      "sessionCount": 120,
      "efficiencyScore": 0.85,
      "isPrivate": false
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 50,
    "total": 500,
    "totalPages": 10,
    "hasMore": true
  }
}
```

### è®¤è¯å¤´

| å¤´éƒ¨          | è¯´æ˜                | å¿…éœ€ |
| ------------- | ------------------- | ---- |
| `X-API-Key`   | ç”¨äºè®¤è¯çš„ API å¯†é’¥ | æ˜¯   |
| `X-Timestamp` | Unix æ—¶é—´æˆ³ï¼ˆç§’ï¼‰   | POST |
| `X-Signature` | HMAC-SHA256 ç­¾å    | POST |

### HMAC ç­¾åè®¡ç®—

```
message = timestamp + ":" + request_body
signature = HMAC-SHA256(api_key, message)
```

ç­¾åéªŒè¯æ¡ä»¶:

- æœ€å¤§æ—¶é—´æˆ³æœ‰æ•ˆæœŸï¼š5 åˆ†é’Ÿ
- å®šæ—¶æ—¶é—´æ¯”è¾ƒä»¥é˜²æ­¢å®šæ—¶æ”»å‡»

## å¼€å‘

### å¯ç”¨è„šæœ¬

```bash
# å¼€å‘
bun run dev          # ä½¿ç”¨ Turbopack å¯åŠ¨å¼€å‘æœåŠ¡å™¨

# æ„å»º
bun run build        # ç”Ÿäº§æ„å»º
bun run start        # å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨

# æ•°æ®åº“
bun run db:generate  # ç”Ÿæˆ Drizzle è¿ç§»
bun run db:migrate   # è¿è¡Œè¿ç§»
bun run db:push      # ç›´æ¥æ¨é€æ¶æ„
bun run db:studio    # æ‰“å¼€ Drizzle Studio GUI
bun run db:seed      # ç§å­ç¤ºä¾‹æ•°æ®

# è´¨é‡
bun run lint         # è¿è¡Œ Biome linter
bun run lint:fix     # ä¿®å¤ linter é—®é¢˜
bun run format       # ä»£ç æ ¼å¼åŒ–
bun run type-check   # TypeScript ç±»å‹æ£€æŸ¥
```

### ä»£ç é£æ ¼

æœ¬é¡¹ç›®ä½¿ç”¨ **Biome** è¿›è¡Œ linter å’Œæ ¼å¼åŒ–ï¼š

```bash
# æ£€æŸ¥é—®é¢˜
bun run lint

# è‡ªåŠ¨ä¿®å¤
bun run lint:fix

# æ ¼å¼åŒ–ä»£ç 
bun run format
```

### æœ¬åœ°æµ‹è¯•

1. **ä½¿ç”¨ curl è¿›è¡Œ API æµ‹è¯•**

```bash
# API çŠ¶æ€æ£€æŸ¥
curl http://localhost:3000/api/v1/status

# API å¯†é’¥éªŒè¯
curl -H "X-API-Key: your_api_key" http://localhost:3000/api/v1/verify
```

2. **æ•°æ®åº“ Studio**

```bash
bun run db:studio
```

Drizzle Studio åœ¨ [https://local.drizzle.studio](https://local.drizzle.studio) æ‰“å¼€ã€‚

## éƒ¨ç½²

### ç”Ÿäº§éƒ¨ç½²

1. **æœåŠ¡å™¨è®¾ç½®**
   - Docker å®¹å™¨ä¸­è¿è¡Œ PostgreSQL
   - Caddy é…ç½®ä¸º HTTPS åå‘ä»£ç†
   - PM2 ç®¡ç† Node.js è¿›ç¨‹

2. **é€šè¿‡ SCP éƒ¨ç½²**

   ```bash
   # å°†æ–‡ä»¶å¤åˆ¶åˆ°æœåŠ¡å™¨
   scp -r apps/web/ user@server:/path/to/modu-arena/apps/web/

   # åœ¨æœåŠ¡å™¨ä¸Š: æ„å»ºå¹¶é‡å¯
   cd /path/to/modu-arena/apps/web
   npx next build
   pm2 restart modu-arena-web
   ```

3. **å®šæ—¶ä»»åŠ¡**

   é€šè¿‡ crontab æˆ– PM2 cron é…ç½®è‡ªåŠ¨åŒ–ä»»åŠ¡ï¼š

   - **æ’åè®¡ç®—**: æ¯å¤© UTC åˆå¤œ â€” `GET /api/cron/calculate-rankings`
   - **æ•°æ®æ¸…ç†**: æ¯å¤© UTC å‡Œæ™¨ 2 ç‚¹ â€” `GET /api/cron/cleanup-data`

## å®‰å…¨

### è®¤è¯

- **ç½‘é¡µä»ªè¡¨æ¿**: Custom JWTï¼ˆé‚®ç®± OTP æ³¨å†Œ + å¯†ç ç™»å½•ï¼‰
- **CLI API**: API å¯†é’¥ + HMAC-SHA256 ç­¾å

### API å®‰å…¨åŠŸèƒ½

| åŠŸèƒ½         | å®ç°                               |
| ------------ | ---------------------------------- |
| API å¯†é’¥å“ˆå¸Œ | SHA-256ï¼ˆä»…å­˜å‚¨å“ˆå¸Œï¼‰              |
| è¯·æ±‚ç­¾å     | å¸¦æ—¶é—´æˆ³çš„ HMAC-SHA256             |
| é€Ÿç‡é™åˆ¶     | 100 req/minï¼ˆåŸºäº Redis çš„åˆ†å¸ƒå¼ï¼‰ |
| å®šæ—¶æ”»å‡»é˜²æ­¢ | å®šæ—¶æ—¶é—´æ¯”è¾ƒ                       |
| é‡æ”¾æ”»å‡»é˜²æ­¢ | 5 åˆ†é’Ÿæ—¶é—´æˆ³æœ‰æ•ˆæœŸçª—å£             |
| ä¼šè¯å®Œæ•´æ€§   | æœåŠ¡å™¨ç«¯å“ˆå¸ŒéªŒè¯                   |
| å¼‚å¸¸æ£€æµ‹     | 10 å€ä»¤ç‰Œé˜ˆå€¼æ ‡è®°                  |
| å®¡è®¡æ—¥å¿—     | è®°å½•æ‰€æœ‰å®‰å…¨äº‹ä»¶                   |

### é€Ÿç‡é™åˆ¶

| ç«¯ç‚¹ç±»å‹ | é™åˆ¶    | çª—å£   |
| -------- | ------- | ------ |
| ä¸€èˆ¬ API | 100 req | 1 åˆ†é’Ÿ |
| è®¤è¯     | 10 req  | 1 åˆ†é’Ÿ |
| æ•æ„Ÿæ“ä½œ | 30 req  | 1 åˆ†é’Ÿ |
| å…¬å¼€è¯»å– | 200 req | 1 åˆ†é’Ÿ |

### å®‰å…¨äº‹ä»¶ç±»å‹

å®¡è®¡æ—¥å¿—è·Ÿè¸ªçš„äº‹ä»¶ï¼š

- `api_key_generated` / `api_key_regenerated` / `api_key_revoked`
- `api_key_validated` / `api_key_invalid`
- `hmac_signature_invalid` / `hmac_timestamp_expired`
- `rate_limit_exceeded`
- `session_created` / `session_duplicate`
- `suspicious_activity`
- `privacy_mode_changed`

## æ€§èƒ½å’Œå¯æ‰©å±•æ€§

### ç¼“å­˜ç­–ç•¥

ä½¿ç”¨æœåŠ¡å™¨ç«¯ç¼“å­˜ä¼˜åŒ– API å“åº”æ—¶é—´ã€‚

#### ç¼“å­˜ TTL è®¾ç½®

| æ•°æ®ç±»å‹     | TTL          | è¯´æ˜               |
| ------------ | ------------ | ------------------ |
| æ—¥æ¬¡æ’è¡Œæ¦œ   | 23 å°æ—¶      | ä¸‹æ¬¡æ’åè®¡ç®—å‰æœ‰æ•ˆ |
| å‘¨æ¬¡æ’è¡Œæ¦œ   | 6 å¤© 23 å°æ—¶ | ä¸‹æ¬¡æ’åè®¡ç®—å‰æœ‰æ•ˆ |
| æœˆæ¬¡æ’è¡Œæ¦œ   | 29 å¤©        | ä¸‹æ¬¡æ’åè®¡ç®—å‰æœ‰æ•ˆ |
| å…¨æœŸé—´æ’è¡Œæ¦œ | 6 å¤© 23 å°æ—¶ | ä¸å‘¨æ¬¡æ’è¡Œæ¦œåŒæ­¥   |
| ç”¨æˆ·æ’å     | 1 å°æ—¶       | ä¸ªåˆ«ç”¨æˆ·æ•°æ®       |
| ç”¨æˆ·ç»Ÿè®¡     | 30 åˆ†é’Ÿ      | ä»ªè¡¨æ¿è¯¦ç»†ç»Ÿè®¡     |
| å…¨å±€ç»Ÿè®¡     | 15 åˆ†é’Ÿ      | å…¨å±€èšåˆæ•°æ®       |

#### ç¼“å­˜å¤±æ•ˆ

æ’åè®¡ç®— Cron ä»»åŠ¡å®Œæˆåè‡ªåŠ¨ä½¿ç›¸å…³ç¼“å­˜å¤±æ•ˆï¼š

```typescript
// æ’åè®¡ç®—åæ‰§è¡Œ
await delPattern(`modu-arena:leaderboard:daily:*`);
await delPattern(`modu-arena:leaderboard:weekly:*`);
await delPattern(`modu-arena:leaderboard:monthly:*`);
await delPattern(`modu-arena:leaderboard:all_time:*`);
```

#### ä¼˜é›…é™çº§

å½“ Redis è¿æ¥å¤±è´¥æ—¶ï¼Œç»•è¿‡ç¼“å­˜å¹¶ç›´æ¥ä»æ•°æ®åº“æŸ¥è¯¢æ•°æ®ä»¥é˜²æ­¢æœåŠ¡ä¸­æ–­ã€‚

### æ•°æ®ä¿ç•™ç­–ç•¥

ç”¨äºç®¡ç†æ•°æ®åº“å¤§å°å¹¶ç»´æŠ¤æ€§èƒ½çš„è‡ªåŠ¨æ•°æ®æ¸…ç†ç­–ç•¥ã€‚

#### ä¿ç•™æœŸé™

| è¡¨                 | ä¿ç•™æœŸé™ | æ¸…ç†ç›®æ ‡            |
| ------------------ | -------- | ------------------- |
| `token_usage`      | 90 å¤©    | 90 å¤©ä»¥å‰çš„è®°å½•     |
| `daily_aggregates` | 90 å¤©    | 90 å¤©ä»¥å‰çš„èšåˆæ•°æ® |
| `rankings` (æ—¥æ¬¡)  | 30 å¤©    | 30 å¤©ä»¥å‰çš„æ—¥æ¬¡æ’å |
| `sessions`         | 90 å¤©    | 90 å¤©ä»¥å‰çš„ä¼šè¯è®°å½• |

#### æ¸…ç†æ—¶é—´è¡¨

- **æ‰§è¡Œæ—¶é—´**: æ¯å¤©å‡Œæ™¨ 2 ç‚¹ UTC
- **æ‰¹å¤„ç†**: ä»¥ 100 ä¸ºå•ä½å¤„ç†ä»¥åˆ†æ•£æ•°æ®åº“è´Ÿè½½
- **æ—¥å¿—è®°å½•**: è®°å½•åˆ é™¤çš„è®°å½•æ•°å’Œæ‰§è¡Œæ—¶é—´

#### æ¸…ç†é€»è¾‘ç¤ºä¾‹

```typescript
// æ¸…ç† 90 å¤©ä»¥å‰çš„ token_usage
while (true) {
  const idsToDelete = await pooledDb
    .select({ id: tokenUsage.id })
    .from(tokenUsage)
    .where(lt(tokenUsage.recordedAt, cutoffDate))
    .limit(100);

  if (idsToDelete.length === 0) break;

  for (const row of idsToDelete) {
    await pooledDb.delete(tokenUsage).where(eq(tokenUsage.id, row.id));
  }
}
```

### æ•°æ®åº“ä¼˜åŒ–

#### æ‰¹å¤„ç†

ä½¿ç”¨æ‰¹å¤„ç†ä¼˜åŒ–å¤§é‡æ•°æ®æ’å…¥/æ›´æ–°çš„æ€§èƒ½ï¼š

- **æ‰¹å¤§å°**: 100 æ¡è®°å½•
- **åº”ç”¨äº**: æ’åæ›´æ–°ã€æ—¥æ¬¡èšåˆæ›´æ–°
- **ORM ä¼˜åŒ–**: åˆ©ç”¨ PostgreSQL `INSERT ... ON CONFLICT`

#### è¿æ¥æ± 

ä½¿ç”¨ Drizzle ORM å®ç° PostgreSQL è¿æ¥æ± ï¼š

```typescript
// Database connection with Drizzle ORM
export const db = drizzle(pool, { schema });
```

### æ€§èƒ½ç›‘æ§

#### å…³é”®æŒ‡æ ‡

- API å“åº”æ—¶é—´ï¼ˆç¼“å­˜ Hit vs Missï¼‰
- æ•°æ®åº“æŸ¥è¯¢æ‰§è¡Œæ—¶é—´
- Cron ä»»åŠ¡æ‰§è¡Œæ—¶é—´å’Œå¤„ç†çš„è®°å½•æ•°
- Redis ç¼“å­˜å‘½ä¸­ç‡

#### ä¼˜åŒ–æœºä¼š

- è¯†åˆ«ç¼“å­˜å‘½ä¸­ç‡ä½çš„ç«¯ç‚¹
- ä¼˜åŒ–æ…¢æŸ¥è¯¢
- å®¡æŸ¥ç´¢å¼•æ·»åŠ 
- è€ƒè™‘åˆ†åŒºç­–ç•¥ï¼ˆé«˜æµé‡æ—¶ï¼‰

## ç»¼åˆè¯„åˆ†ç®—æ³•

```
Score = (Token * 0.40) + (Efficiency * 0.25) + (Session * 0.20) + (Streak * 0.15)

è®¡ç®—å…¬å¼:
- Token = min(1, log10(totalTokens + 1) / 10)
- Efficiency = min(outputTokens / inputTokens, 2) / 2
- Session = min(1, log10(sessions + 1) / 3)
- Streak = min(streak, 30) / 30

æœ€ç»ˆè¯„åˆ† = åŠ æƒå’Œ * 1000
```

### è¯„åˆ†ç­‰çº§

| ç­‰çº§ | è¯„åˆ†èŒƒå›´ |
| ---- | -------- |
| é’»çŸ³ | 800+     |
| é“‚é‡‘ | 600-799  |
| é»„é‡‘ | 400-599  |
| ç™½é“¶ | 200-399  |
| é’é“œ | 0-199    |

## è´¡çŒ®

1. Fork ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯: `git checkout -b feature/amazing-feature`
3. è¿›è¡Œæ›´æ”¹
4. è¿è¡Œ linter: `bun run lint:fix`
5. æäº¤: `git commit -m 'feat: add amazing feature'`
6. æ¨é€: `git push origin feature/amazing-feature`
7. æ‰“å¼€ Pull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ **Copyleft License (COPYLEFT-3.0)** è®¸å¯ - è¯¦è§ [LICENSE](../../LICENSE) æ–‡ä»¶ã€‚

---

## Star History

[![Star History Chart](https://api.star-history.com/svg?repos=modu-ai/modu-arena&type=date&legend=top-left)](https://www.star-history.com/#modu-ai/modu-arena&type=date&legend=top-left)

---

## ğŸ™ Made with â¤ï¸ by Modu-Arena Team

**Last Updated:** 2026-01-12
**Modu**: Modu ä»£è¡¨"å¤§å®¶çš„ AI (Modu-ui AI)"ã€‚

> **"æ— é™å¯èƒ½ä¸»ä¹‰ - å¤§å®¶çš„ AI"**
